# 开发日志

## 创建数据库

- 创建数据库 `secondhand_db`
- 字符集：`utf8mb4`
- 排序规则：`utf8mb4_general_ci`

## 后端（Spring Boot 最小骨架）

- 在项目根创建 `backend/`
- 依赖管理：`backend/pom.xml`
  - 父项目：`org.springframework.boot:spring-boot-starter-parent:2.7.12`
  - 主要依赖：
    - `spring-boot-starter-web`
    - `mybatis-spring-boot-starter:2.2.2`
    - `mysql-connector-java:8.0.33`
    - `lombok`
    - `spring-boot-starter-validation`
  - `java.version=11`
- 配置文件：`backend/src/main/resources/application.properties`
  - `server.port=8080`
  - `spring.datasource.url=jdbc:mysql://localhost:3306/secondhand_db?...`
  - `spring.datasource.username=secondhand`
  - `spring.datasource.password=StrongPassword123`（建议改为环境变量或本地配置）
  - `mybatis.mapper-locations=classpath:mapper/*.xml`
  - `mybatis.type-aliases-package=com.example.secondhand.model.entity`
- 代码结构与关键文件：
  - 启动类：`backend/src/main/java/com/example/secondhand/SecondhandApplication.java`
    - `@SpringBootApplication`，入口 `main` 方法启动 Spring Boot
  - 通用返回：`backend/src/main/java/com/example/secondhand/common/Result.java`
    - 三态：`ok(data)`、`ok()`、`fail(msg)`
  - 全局跨域：`backend/src/main/java/com/example/secondhand/config/CorsConfig.java`
    - 通过 `WebMvcConfigurer#addCorsMappings` 设置 `allowedOriginPatterns("*")`、`allowedMethods("*")`、`allowCredentials(true)`
  - 健康检查接口：`backend/src/main/java/com/example/secondhand/controller/PingController.java`
    - `GET /api/ping` 返回 `Result.ok("ok")`
  - 实体：`backend/src/main/java/com/example/secondhand/model/entity/User.java`
    - 字段：`id, username, password, nickname, role, createdAt`
  - Mapper：`backend/src/main/java/com/example/secondhand/mapper/UserMapper.java`
    - 注解式 SQL：`insert(User)`、`findByUsername(String)`、`findById(Long)`

## 2025/11/15
### 构建与运行后端

- 构建：在 `backend/` 执行 `mvn -U clean package`
- 运行：`mvn spring-boot:run`
- 过程记录与问题处理：
  - 首次构建时报错：`mysql:mysql-connector-java` 缺少版本 → 在 `pom.xml` 增加 `<version>8.0.33</version>`
  - 运行/打包过程中出现 `maven-surefire-plugin` 解析网络问题（Connection reset）→ 可临时使用 `-DskipTests` 构建，或配置 Maven 镜像源后重试
  - 验证接口：浏览器或 Postman 访问 `http://localhost:8080/api/ping` 期望 `{"code":0,"msg":"ok","data":"ok"}`

## 前端（Vue3 + Vite 最小骨架并联调 ping）

- 在项目根执行：
  - `npx --yes create-vite@latest frontend --template vue`
  - 进入 `frontend/` 安装依赖：`npm install`
  - 追加安装：`npm install vue-router@4 pinia axios element-plus`
- 关键文件与内容：
  - `frontend/src/main.js`
    - 注册 `Pinia`、`Router`、`ElementPlus`，挂载应用
  - `frontend/src/router/index.js`
    - 路由：`/` → `Home`，`/login` → `Login`
  - `frontend/src/api/index.js`
    - Axios 实例：`baseURL: 'http://localhost:8080/api'`，请求拦截器注入 `Authorization`
  - `frontend/src/views/Home.vue`
    - 页面加载时请求 `GET /api/ping`，将返回 JSON 显示到页面
  - `frontend/src/views/Login.vue`
    - 示例登录表单（后续实现登录接口）
  - `frontend/src/App.vue`
    - 渲染 `<router-view />`
  - `frontend/vite.config.js`
    - `resolve.alias` 增加 `@` 指向 `src`
- 启动与预览：
  - 在 `frontend/` 执行 `npm run dev`
  - 打开 `http://localhost:5173/`
  - 联调说明：后端未启动或跨域异常时，`Home` 页面会显示错误信息；后端启动且 CORS 开放时显示后端返回 JSON

提交信息建议

chore(init): 导入 SecondHandSystem 前后端项目骨架

- 后端
  - Spring Boot 2.7.12 最小可运行骨架（web、validation、MyBatis、MySQL）
  - 接入 JWT（jjwt）与 BCrypt，新增 JwtFilter 实现 Authorization 解析与 userId 注入
  - 通用返回 Result 与 GlobalExceptionHandler
  - 实体与数据访问：User、Category、Product；CategoryMapper、ProductMapper（分页+分类+关键字）
  - 业务层：ProductService/Impl
  - 接口：PingController、AuthController（注册/登录）、UserController（受保护 /api/user/me）、CategoryController（列表/创建）、ProductController（列表/详情/新增/更新/删除）
  - 图片上传：UploadController 保存到磁盘并返回 URL；WebConfig 映射 /uploads/** 到 E:/JavaWeb/SecondHandSystem/test/
  - 配置：application.properties（数据源、MyBatis、端口等）

- 前端
  - Vue3 + Vite 脚手架，集成 vue-router、pinia、axios、element-plus
  - 路由：/（列表）、/login、/register、/publish（需登录）、/product/:id；全局守卫校验 token
  - Axios 拦截器注入 Authorization，Vite 代理 `/api` 与 `/uploads` 到后端
  - 页面与组件：Home（分类筛选/搜索/分页）、ProductPublish（图片上传与发布）、ProductDetail（标题/价格/描述/图片）、ProductCard（卡片展示）
  - 顶部状态栏：显示当前登录状态与退出

- 其他
  - 新增 .gitignore（忽略 node_modules、target、IDE 文件、上传目录实际文件等）
  - 开发日志更新，记录搭建过程与联调说明

备注
- 上传路径与静态映射已打通：前端使用 /uploads/xxx.jpg 即可访问
- 若后端端口调整，需同步更新前端代理或 axios baseURL
- 价格区间筛选目前未接入（可选），后续可扩展 minPrice/maxPrice 参数与 SQL 条件